# Supervisord configuration
# Manages multiple processes in a single container

[supervisord]
# Don't daemonize - run in foreground (required for Docker)
nodaemon=true

# Log configuration
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log

# ============================================
# Program 1: SSH Server
# ============================================
[program:sshd]
# Command to run
command=/usr/sbin/sshd -D

# Restart if it crashes
autorestart=true

# Start this first (lower number = higher priority)
priority=10

# Log files
stdout_logfile=/var/log/sshd_stdout.log
stderr_logfile=/var/log/sshd_stderr.log

# ============================================
# Program 2: Azure Pipelines Agent
# ============================================
[program:azp-agent]
# Run our start.sh script
command=/start.sh agent

# Restart if it crashes
autorestart=true

# Start this after SSH (higher number = lower priority)
priority=20

# Log files
stdout_logfile=/var/log/agent_stdout.log
stderr_logfile=/var/log/agent_stderr.log